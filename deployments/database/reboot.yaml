# Resat - RightScale API Automated Test
#
#

name:   Reboot_Server_Template_Deployment
ignore: no
steps:
  
  - request:
      resource:         servers
      id:               $DB_Master
      custom:
        name:           reboot
        type:           post
        separator:      "/"
    filters:
      - name:           extract deployment id
        target:         header
        extractors:
          - field:      location
            pattern:    '.*\/(\d+)$'
            variable:   DB_Master

  - request:
      operation:        show
      resource:         servers
      id:               $DB_Master
    guards:
      - target:         body
        field:          server/state
        pattern:        "decommissioning"
        period:         10
        timeout:        300
        name:           DB_Master_op

  - request:
      operation:        show
      resource:         servers
      id:               $DB_Master
    guards:
      - target:         body
        field:          server/state
        pattern:        "operational"
        period:         10
        timeout:        300
        name:           DB_Master_op

  - request:
      resource:         servers
      id:               $DB_Slave
      custom:
        name:           reboot
        type:           post
        separator:      "/"
    filters:
      - name:           extract deployment id
        target:         header
        extractors:
          - field:      location
            pattern:    '.*\/(\d+)$'
            variable:   DB_Slave

  - request:
      operation:        show
      resource:         servers
      id:               $DB_Slave
    guards:
      - target:         body
        field:          server/state
        pattern:        "decommissioning"
        period:         10
        timeout:        300
        name:           DB_Slave_op

  - request:
      operation:        show
      resource:         servers
      id:               $DB_Slave
    guards:
      - target:         body
        field:          server/state
        pattern:        "operational"
        period:         10
        timeout:        300
        name:           DB_Slave_op

